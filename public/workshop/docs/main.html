<!DOCTYPE html>  <html> <head>   <title>main.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="grunt.html">                 grunt.js               </a>                                           <a class="source" href="formatPriority.html">                 formatPriority.coffee               </a>                                           <a class="source" href="main.html">                 main.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               main.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Fast die gesamte Beispielapp steckt in dieser Datei. Die aus den Kommentaren generierte
Dokumentation liegt im <code>docs</code>-Verzeichnis. Die Kommentare können mit
<a href="http://daringfireball.net/projects/markdown/">Markdown</a> formatiert werden.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Abhängigkeiten</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Die <code>require()</code>-Funktion erwartet zwei Argumente: erstens ein Array mit den
Abhängigkeiten für dieses Script und zweitens die Callback-Funktion, die ausgeführt
wird, sobald alle Abhängigkeiten geladen wurden. Wenn die Abhängigkeiten selbst
AMD-Module sind und Objekte zurückgeben, werden diese an den Callback als Argumente
übergeben. Das ist nicht immer der Fall -- das <code>backbone</code>-Modul hat z.B. jQuery und
<a href="http://underscorejs.org/">Underscrore.js</a> Abhängigkeiten und lädt diese auch. Da
je doch diese beiden Libraries  ihre APIs (<code>$</code> und <code>_</code>) als globale Objekte
bereitstellen, können wir beides in unserer Callback-Funkion verwenden, ohne sie dort
im Callback explizit aufzuführen.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">require</span> <span class="p">[</span><span class="s1">&#39;backbone&#39;</span><span class="p">,</span> <span class="s1">&#39;lib/formatPriority&#39;</span><span class="p">],</span> <span class="nf">(Backbone, formatPriority) -&gt;</span>
  <span class="s1">&#39;use strict&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Model für Pages</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Als <code>Page</code> wird in diesem Beispiel der Inhalt der Hauptspalte bezeichnet. Ein
<strong>Model</strong> hierfür erstellen wir, indem wir von der Model-Vorlage <code>Backbone.Model</code>
über die <strong><code>extend()</code>-Methode</strong> ein Abziehbild erstellen und unsere eigenen
Eigenschaften hineinschreiben. Wir können einerseits vorhandene Eigenschaften und
Methoden überschreiben (z.B. <code>initialize</code>), andererseits auch komplett eigene
Eigenschaften festlegen (z.B. <code>show</code>).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">PageModel = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Wir überschreiben die normale (nichts machende) <code>initialize()</code>-Methode, um zu Beginn
immer <code>start</code> als Page zu verwenden</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">initialize: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p><strong>Tipp:</strong> <code>@</code> ist CoffeeScript das gleiche wie <code>this.</code></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@set</span> <span class="p">{</span>
        <span class="nv">page: </span><span class="s1">&#39;start&#39;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Eine eigene Methode, die nichts weiter macht als auf komfortable Art und Weise die
Werte <code>page</code> und <code>id</code> zu setzen. Bei <code>id</code> aufpassen, dass es eine Number ist - der
Parameter kommt als String aus der URL an</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">show: </span><span class="nf">(page, id) -&gt;</span>
      <span class="nx">@set</span> <span class="p">{</span>
        <span class="nv">page: </span><span class="nx">page</span>
        <span class="nv">id: </span><span class="nb">Number</span> <span class="nx">id</span>
      <span class="p">}</span>

  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Neue Instanz des Page-Models anlegen. Wenn wir die Page wechseln wollen, können wir
das Page.show(page, id) machen - den Job übernimmt der Router weiter unten.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">Page = </span><span class="k">new</span> <span class="nx">PageModel</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h2>View für Pages</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Views sind für den Output von Daten verantwortlich. Man kann sie direkt mit Models
verzahnen, muss das aber nicht tun. Eigentlich <em>muss</em> man gar nichts - Views sind sehr
flexibel und es gibt nicht viele Vorgaben. Dieser PageView dient dazu, den Inhalt der
Hauptspalte <code>#main</code> neu zu rendern.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">PageView = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Jeder View repräsentiert ein HTML-Element. Das kann entweder ein bereits vorhandenes
Element in der Seite sein oder es kann kann auch erst vom View erzeugt werden. In
diesem Fall ist das Element für diesen View (View-Eigenschaft <code>el</code>) ein Element in
der Seite - daher der Selektor hier.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">el: </span><span class="s1">&#39;#Main&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p><code>render()</code> ist die View-Methode für die Ausgabe. Standardmäßig macht <code>render()</code> gar
nichts, d.h. man <em>muss</em> für jeden View eine eigene Methode schreiben. Diese Variante
nimmt einen Titel und Inhalt an und befüllt damit die entsprechenden Elemente.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">render: </span><span class="nf">(title, html) -&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#Headline&#39;</span><span class="p">).</span><span class="nx">html</span> <span class="nx">title</span>                   <span class="c1"># Überschrift setzen</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p><strong>Tipp:</strong> In Strings mit " gibt es String-Interpolation mit <code>#{variable}</code></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Beispiel-App - #{title}&quot;</span><span class="p">)</span>  <span class="c1"># `&lt;title&gt;` setzen</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p><strong>Tipp:</strong> <code>$el</code> in Views ist ein jQuery-Objekt mit dem <code>el</code> des Views</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span>             <span class="c1"># Das Element des Views mit Inhalt befüllen</span>
      <span class="k">return</span> <span class="k">this</span>

  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h2>Model für Einträge</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">Item = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h2>Collection für Einträge</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Wenn wir Gruppen von Models verwalten wollen, sind <strong>Collections</strong> das Mittel der
Wahl.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ItemCollection = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{</span>
    <span class="nv">model: </span><span class="nx">Item</span>                 <span class="c1"># Was für ein Model findet sich in dieser Collection?</span>
    <span class="nv">url: </span><span class="s1">&#39;api/index.php/items&#39;</span>  <span class="c1"># Wo ist die REST-Api für die Daten?</span>
  <span class="p">}</span>
  <span class="nv">Items = </span><span class="k">new</span> <span class="nx">ItemCollection</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h2>View für Einträge</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ItemView = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p><strong>Tipp:</strong> In CoffeeScript hat Multiline-Strings</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">templates: </span><span class="p">{</span>
      <span class="nv">list: </span><span class="s1">&#39;&lt;span id=&quot;list-item-&lt;%= id %&gt;&quot; class=&quot;item-title&quot;&gt;&lt;%= title %&gt;&lt;/span&gt;</span>
<span class="s1">              (Priorität: &lt;span class=&quot;priority&quot;&gt;&lt;%= priority %&gt;&lt;/span&gt;)&#39;</span>
      <span class="nv">full: </span><span class="s1">&#39;&lt;h3&gt;&lt;%= title %&gt;&lt;/h3&gt;</span>
<span class="s1">              &lt;p&gt;(Priorität: &lt;span class=&quot;priority&quot;&gt;&lt;%= priority %&gt;&lt;/span&gt;)&lt;/p&gt;</span>
<span class="s1">              &lt;p&gt;[ &lt;span class=&quot;clickable close-item&quot;&gt;Schließen&lt;/span&gt; ]&#39;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Da Einträge könnten recht vielfältig verwendet werden können, richten wir uns auf
flexible Nutzung von Templates ein. Falls <code>options.template</code> gesetzt ist, prüfen
wir, ob der Wert ein Key von <code>@templates</code> ist. Falls das der Fall ist, wird dessen
Wert verwendet, andernfalls behandeln wir den übergebenen String selbst als
Template. Das Template kompilieren wir in eine Funktion, die wir am Ende nur noch
aufrufen müssen.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">initialize: </span><span class="nf">(options) -&gt;</span>
      <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">template</span>
        <span class="nv">tpl = </span><span class="nx">@templates</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">template</span><span class="p">]</span> <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">template</span> <span class="k">of</span> <span class="nx">@templates</span>
        <span class="vi">@template = </span><span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">tpl</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Für das Rendering verwenden wir das übergebene Template und hängen das fertige
Element direkt in <code>target</code> ein.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">render: </span><span class="nf">(target) -&gt;</span>
      <span class="nv">target = </span><span class="nx">$</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">target</span> <span class="k">instanceof</span> <span class="nx">jQuery</span>
      <span class="nv">html = </span><span class="nx">@template</span> <span class="p">{</span>
        <span class="nv">id: </span><span class="nx">@model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="nv">title: </span><span class="nx">@model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
        <span class="nv">priority: </span><span class="nx">formatPriority</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;priority&#39;</span><span class="p">)</span> <span class="c1"># Schön formatiert</span>
      <span class="p">}</span>
      <span class="nx">@$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span>
      <span class="k">return</span> <span class="k">this</span>

  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h2>Router</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Im Router werden URLs auf Funktionen gemappt und auch die Funktionen selbst definiert.
In unserem Fall machen diese Funktionen nichts weiter, als die entspechenden
Änderungen im Page-Model auszulösen. Auf diese Änderungen können dann wiederum andere
Teile der Applikation reagieren</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">AppRouter = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Zuordnung von Routen und Funktionsnamen im Router</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">routes: </span><span class="p">{</span>
      <span class="s1">&#39;&#39;</span>          <span class="o">:</span> <span class="s1">&#39;start&#39;</span> <span class="c1"># Startseite</span>
      <span class="s1">&#39;about&#39;</span>     <span class="o">:</span> <span class="s1">&#39;about&#39;</span> <span class="c1"># Info-Seite</span>
      <span class="s1">&#39;view&#39;</span>      <span class="o">:</span> <span class="s1">&#39;view&#39;</span>  <span class="c1"># Alle Einträge</span>
      <span class="s1">&#39;view/:num&#39;</span> <span class="o">:</span> <span class="s1">&#39;view&#39;</span>  <span class="c1"># Alle Einträge + Eintrag mit der Nummer `:num`</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Startseite</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">start: </span><span class="o">-&gt;</span>
      <span class="nx">Page</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Info-Seite</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">about: </span><span class="o">-&gt;</span>
      <span class="nx">Page</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="s1">&#39;about&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Alle Einträge auflisten und Ggf. den Eintrag mit der Nummer <code>:num</code> einblenden</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">view: </span><span class="nf">(num) -&gt;</span>
      <span class="nx">Page</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="nx">num</span><span class="p">)</span>

  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Router anwerfen</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">App = </span><span class="k">new</span> <span class="nx">AppRouter</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <h2>Pages-Model überwachen</h2>

<p>Änderungen an der URL lösen also Änderungen am Pages-Model aus. Um auf diese zu
reagieren, hängen wir einfach ein paar Events an das Model an.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">openItem = </span><span class="kc">null</span><span class="p">;</span> <span class="c1"># Welcher Eintrag ist geöffnet?</span>

  <span class="nx">Page</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;change:page&#39;</span><span class="p">,</span> <span class="nf">(model, value) -&gt;</span>
    <span class="k">switch</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Statische Startseite anzeigen. Wir laden einfach per jQuery die Template-Datei
<code>static/start.tpl.html</code> und geben ihren Inhalt an den Page-View weiter</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">when</span> <span class="s1">&#39;start&#39;</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">get</span> <span class="s1">&#39;static/start.tpl.html&#39;</span><span class="p">,</span> <span class="nf">(result) -&gt;</span>
          <span class="k">if</span> <span class="nx">openItem</span><span class="o">?</span> <span class="k">then</span> <span class="nx">openItem</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
          <span class="k">new</span> <span class="nx">PageView</span><span class="p">().</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;Startseite&#39;</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>About-Seite anzeigen. Template-Datei laden und den Inhalt als Template-String
verarbeiten. Der Platzhalter <code>&lt;%= date %&gt;</code> wird durch das aktuelle Datum ersetzt</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">when</span> <span class="s1">&#39;about&#39;</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">get</span> <span class="s1">&#39;static/about.tpl.html&#39;</span><span class="p">,</span> <span class="nf">(tpl) -&gt;</span>
          <span class="nv">content = </span><span class="nx">_</span><span class="p">.</span><span class="nx">template</span> <span class="nx">tpl</span><span class="p">,</span> <span class="p">{</span>
            <span class="nv">date: </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toString</span><span class="p">()</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="nx">openItem</span><span class="o">?</span> <span class="k">then</span> <span class="nx">openItem</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
          <span class="k">new</span> <span class="nx">PageView</span><span class="p">().</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;Über dieses Beispiel&#39;</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Einträge anzeigen. Wenn im Model darüber hinaus noch <code>num</code> nicht <code>undefined</code> ist,
müssen wir auch noch einen Einzel-Eintrag zeigen.</p>

<ol>
<li>Template-Datei laden, in die Page rendern</li>
<li>Items mittels <code>fetch()</code> vom Server holen</li>
<li>Für jedes Item einen neuen <code>ItemView</code> in das Ziel-Element schreiben</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">when</span> <span class="s1">&#39;view&#39;</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">get</span> <span class="s1">&#39;static/view.tpl.html&#39;</span><span class="p">,</span> <span class="nf">(result) -&gt;</span>
          <span class="k">new</span> <span class="nx">PageView</span><span class="p">().</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;Einträge&#39;</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span>
          <span class="nx">Items</span><span class="p">.</span><span class="nx">fetch</span> <span class="p">{</span>  <span class="c1"># `fetch()` wie einen ganz normalen jQuery-Request konfigurieren</span>

            <span class="nv">success: </span><span class="nf">(collection) -&gt;</span>
              <span class="nx">collection</span><span class="p">.</span><span class="nx">each</span> <span class="nf">(listItem) -&gt;</span>  <span class="c1"># `each()` ist eine Methode aus Underscore.js</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Item-View-Instanz mit Konfiguation erstellen</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nv">item = </span><span class="k">new</span> <span class="nx">ItemView</span> <span class="p">{</span>
                  <span class="nv">tagName: </span><span class="s1">&#39;li&#39;</span>     <span class="c1"># Container-Tag (Standard: `div`)</span>
                  <span class="nv">model: </span><span class="nx">listItem</span>   <span class="c1"># Model für diesen View</span>
                  <span class="nv">template: </span><span class="s1">&#39;list&#39;</span>  <span class="c1"># Template-Vorlage oder -String</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Item-Events mit Event Delegation. In dem Event-Hash sind die Keys
Strings mit dem Event (hier: <code>click</code>) und dem Selektor, auf dem Event
aktiv werden soll (hier: <code>title</code>). Der Klick auf den Titel soll den
Eintrag in der Großansicht zeigen.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">item</span><span class="p">.</span><span class="nx">delegateEvents</span> <span class="p">{</span>
                  <span class="s1">&#39;click .item-title&#39;</span><span class="o">:</span> <span class="nf">(evt) -&gt;</span>
                    <span class="nv">id = </span><span class="nx">$</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">).</span><span class="nx">pop</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Der Status "offener Eintrag" soll auch in der URL abgebildet werden,
daher lassen wir uns von dem Router an eine entsprechende Adresse
schicken. Mit <code>{ trigger: no }</code> verhindern wir allerdings, dass
diese Aktion die entsprechenden Events auf dem Router-Objekt
auslöst - wir wollen ja nur einen großen Eintrag anzeigen und das
können wir am besten direkt hier machen. <strong>Tipp:</strong> In CoffeeScript
sind <code>no</code> und <code>off</code> das gleiche wie <code>false</code>. Entsprechend sind <code>yes</code>
und <code>on</code> das gleiche wie <code>true</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">App</span><span class="p">.</span><span class="nx">navigate</span> <span class="s2">&quot;#view/#{id}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Ein großen Eintrag anzeigen ist ganz einfach: neue View-Instanz
mit den passenden Events erstellen und das Ganze in den Body
rendern. Vorher muss natürlich der ggf. schon geöffnete Eintrag
geschlossen werden</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="k">if</span> <span class="nx">openItem</span><span class="o">?</span> <span class="k">then</span> <span class="nx">openItem</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
                    <span class="nv">openItem = </span><span class="k">new</span> <span class="nx">ItemView</span> <span class="p">{</span>
                      <span class="nv">model: </span><span class="nx">Items</span><span class="p">.</span><span class="nx">at</span> <span class="nx">id</span>
                      <span class="nv">className: </span><span class="s1">&#39;item-bigview&#39;</span>
                      <span class="nv">template: </span><span class="s1">&#39;full&#39;</span>
                    <span class="p">}</span>
                    <span class="nx">openItem</span><span class="p">.</span><span class="nx">delegateEvents</span> <span class="p">{</span>
                      <span class="s1">&#39;click .close-item&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
                        <span class="nx">@remove</span><span class="p">()</span>  <span class="c1"># Entfernt das Element des Views aus dem DOM</span>
                        <span class="nx">App</span><span class="p">.</span><span class="nx">navigate</span> <span class="s2">&quot;#view&quot;</span>
                    <span class="p">}</span>
                    <span class="nx">openItem</span><span class="p">.</span><span class="nx">render</span> <span class="s1">&#39;body&#39;</span>

                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Den Eintrag in die Liste hineinrendern.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">item</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;#ItemsList&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Falls das Page-Model <code>id</code> gesetzt hat und diese ID mit der Nummer
unseres gerade behandelten Eintrags übereinstimmt, müssen wir diesen
groß einblenden. Das machen wir einfach, indem wir ein Klick-Event auf
dem View triggern.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="nx">Page</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="nx">item</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
                  <span class="nx">item</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.item-title&#39;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">)</span>
          <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Das Page-Model auf Änderungen des <code>id</code>-Parameters überwachen</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Page</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;change:id&#39;</span><span class="p">,</span> <span class="nf">(model, id) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Wenn die ID nicht undefiniert/null ist, die View-Page angezeigt wird und die
Collection ein Item mit der ID enthält, dieses groß anzeigen. Vorher ggf. offene
Einträge schließen</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">id</span><span class="o">?</span> <span class="o">&amp;&amp;</span> <span class="nx">Page</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;view&#39;</span>
      <span class="nv">item = </span><span class="nx">Items</span><span class="p">.</span><span class="nx">find</span> <span class="nf">(model) -&gt;</span>
        <span class="k">return</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="nx">id</span>
      <span class="k">if</span> <span class="nx">item</span><span class="o">?</span>
        <span class="k">if</span> <span class="nx">openItem</span><span class="o">?</span> <span class="k">then</span> <span class="nx">openItem</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
        <span class="nv">openItem = </span><span class="k">new</span> <span class="nx">ItemView</span> <span class="p">{</span>
          <span class="nv">model: </span><span class="nx">item</span>
          <span class="nv">className: </span><span class="s1">&#39;item-bigview&#39;</span>
          <span class="nv">template: </span><span class="s1">&#39;full&#39;</span>
        <span class="p">}</span>
        <span class="nx">openItem</span><span class="p">.</span><span class="nx">delegateEvents</span> <span class="p">{</span>
          <span class="s1">&#39;click .close-item&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
            <span class="nx">@remove</span><span class="p">()</span>
            <span class="nx">App</span><span class="p">.</span><span class="nx">navigate</span> <span class="s2">&quot;#view&quot;</span>
        <span class="p">}</span>
        <span class="nx">openItem</span><span class="p">.</span><span class="nx">render</span> <span class="s1">&#39;body&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <h2>App starten</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Die URL auf Änderungen überwachen</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 